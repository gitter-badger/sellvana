{% set m = THIS.get('model') %}
{% if APP.m('FCom_CustomerGroups').run_status == 'LOADED' %}
    {% set customerGroups = APP.instance('FCom_CustomerGroups_Model_Group').groupsOptions() %}
{% endif %}
{% set validator = THIS.get('validator') %}

<script>
    //var custModule = angular.module('custModule', []);

    function CustomerAddressesCtrl($scope) {
        $scope.addresses = {{ UTIL.toJson(APP.instance('BDb').many_as_array(m.addresses))|raw }};
        $scope.countries = {{ UTIL.toJson(APP.instance('FCom_Geo_Model_Country').options())|raw }};
        $scope.regions = {{ UTIL.toJson(APP.instance('FCom_Geo_Model_Region').allOptions())|raw }};

        $scope.del_ids = [];
        $scope.newId = 0;

        $scope.addAddress = function() {
            $scope.addresses.push({edit_mode:true, id:--$scope.newId});
        }

        $scope.delAddress = function(addr) {
            for (var i = 0, ii = $scope.addresses.length; i<ii; i++) {
                if (addr === $scope.addresses[i]) {
                    $scope.addresses.splice(i, 1);
                }
            }
            if (addr.id>0) {
                $scope.del_ids.push(addr.id);
            }
        }
    }

    function CustomerAddressCtrl($scope) {

    }
</script>

<div ng-app ng-controller="CustomerAddressesCtrl" class="col-md-10">
    <div class="col-customer-info">
        <fieldset>
            <h3 class="form-group-title">{{ "Personal Information"|_ }}</h3>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-firstname">{{ 'First Name'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-firstname" class="form-control" type="text" name="model[firstname]" value="{{ validator.fieldValue('firstname') }}" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-lastname">{{ 'Last Name'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-lastname" class="form-control" type="text" name="model[lastname]" value="{{ validator.fieldValue('lastname') }}" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-email">{{ 'Email'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-email" class="form-control" type="email" name="model[email]" value="{{ validator.fieldValue('email') }}" />
                </div>
            </div>
            {% if customerGroups is defined %}
                <div class="form-group">
                    <label class="col-md-2 control-label" for="model-group">{{ 'Customer Group'|_ }}</label>
                    <div class="col-md-5">
                        <select class="form-control" name="model[customer_group]" id="model-group">
                            {{ UTIL.optionsHtml(customerGroups, validator.fieldValue('customer_group'))|raw }}
                        </select>
                    </div>
                </div>
            {% endif %}
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-phone">{{ 'Daytime Phone'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-phone" class="form-control" type="text" name="model[phone]" value="{{ validator.fieldValue('phone') }}" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-phone_evening">{{ 'Evening Phone'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-phone_evening" class="form-control" type="text" name="model[phone_evening]" value="{{ validator.fieldValue('phone_evening') }}" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-status">{{ 'Status'|_ }}</label>
                <div class="col-md-5">
                    <input type="hidden" name="model[status]" value="0" />
                    <input id="model-status" type="checkbox" class="switch-cbx" name="model[status]" value="1" {% if validator.fieldValue('status') == 1 %}checked="checked" {% endif %} />
                </div>
            </div>
        </fieldset>

        <fieldset>
            <h3 class="form-group-title">{{ 'Password Reset'|_ }}</h3>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-password">{{ 'New Password'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-password" type="password" class="form-control" name="model[password]" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" for="model-password_confirm">{{ 'Confirm Password'|_ }}</label>
                <div class="col-md-5">
                    <input id="model-password_confirm" type="password" class="form-control" name="model[password_confirm]")
                </div>
            </div>
        </fieldset>
    </div>

    <div class="col-customer-address" ng-controller="CustomerAddressesCtrl" ng-show="true" style="display:none">
        <fieldset>
            <h3 class="form-group-title">{{ 'Addresses'|_ }}</h3>
            <div ng-repeat="a in addresses">
                <a class="btn-remove" href="#" ng-click="delAddress(a)">[X]</a>
                <input type="checkbox" ng-model="a.edit_mode" /> {{ 'Edit'|_ }}
                <div class="adr">
                    <div class="form-group street-address">
                        <input type="text" class="form-control" ng-show="a.edit_mode" ng-model="a.street1" placeholder="{{ 'Street 1'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.street1"></span>
                    </div>
                    <div class="form-group extended-address" ng-show="a.street2 || a.edit_mode">
                        <input type="text" class="form-control" ng-show="a.edit_mode" ng-model="a.street2" placeholder="{{ 'Street 2'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.street2"></span>
                    </div>
                    <div class="form-group extended-address" ng-show="a.street3 || a.edit_mode">
                        <input type="text" class="form-control" ng-show="a.edit_mode" ng-model="a.street3" placeholder="{{ 'Street 3'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.street3"></span>
                    </div>

                    <div class="form-group locality">
                        <input type="text" class="form-control" ng-show="a.edit_mode" ng-model="a.city" placeholder="{{ 'City'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.city"></span>
                    </div>
                    <div class="form-group region">
                        <select ng-show="a.edit_mode && regions[a.country]" class="form-control" ng-options="name for (key,name) in regions[a.country]" ng-model="a.region" fcom-select2>
                            <option></option>
                        </select>
                        <input type="text" class="form-control" ng-show="a.edit_mode && !regions[a.country]" ng-model="a.region" placeholder="{{ 'Region/State'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.region"></span>
                    </div>
                    <div class="form-group postal-code">
                        <input type="text" class="form-control" ng-show="a.edit_mode" ng-model="a.postcode" size="6" placeholder="{{ 'Zip/Postal Code'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.postcode"></span>
                    </div>

                    <div class="form-group country-name">
                        <select class="form-control" ng-show="a.edit_mode" ng-options="key as name for (key,name) in countries" ng-model="a.country" fcom-select2> </select>
                        <span ng-hide="a.edit_mode" ng-bind="countries[a.country]"></span>
                    </div>
                    <div class="form-group phone">
                        <input class="form-control" type="text" ng-show="a.edit_mode" ng-model="a.phone" placeholder="{{ 'Phone'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.phone"></span>
                    </div>
                    <div class="form-group fax">
                        <input class="form-control" type="text" ng-show="a.edit_mode" ng-model="a.fax" placeholder="{{ 'Fax'|_ }}" />
                        <span ng-hide="a.edit_mode" ng-bind="a.fax"></span>
                    </div>
                </div>
            </div>

            <a href ng-click="addAddress()" class="add-link">{{ '+ Add Another'|_ }}</a>
            <input type="hidden" name="address[data_json]" value="{% verbatim %}{{addresses}}{% endverbatim %}" />
            <input type="hidden" name="address[del_json]" value="{% verbatim %}{{del_ids}}{% endverbatim %}" />
        </fieldset>
    </div>
</div>
