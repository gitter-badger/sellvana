{% set m = THIS.get('model') %}
{% set validator = THIS.get('validator', m) %}
{% set hlp = APP.instance('FCom_Admin_Model_User') %}

<fieldset class="form-horizontal">
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-username">{{ 'User Name'|_ }}</label>
        <div class="col-md-5">
            <input type="text" id="model-username" name="model[username]" class="required form-control" value="{{ validator.fieldValue('username') }}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-superadmin">{{ 'Super Admin'|_ }}</label>
        <div class="col-md-5">
            <input type="hidden" name="model[is_superadmin]" value="0" />
            <div class="make-switch switch has-switch" data-off-label="<i class='icon-remove'></i>" data-on-label="<i class='icon-ok'></i>" data-on="primary">
                <input type="checkbox" id="model-superadmin" name="model[is_superadmin]"
                       value="1" {{ validator.fieldValue('is_superadmin') == 1 ? 'checked="checked"' : ''  }} />
            </div>

        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-role-id">{{ 'Role'|_ }}</label>
        <div class="col-md-5">
            <select id="model-role-id" name="model[role_id]" class="form-control required">
                <option></option>
                {{ UTIL.optionsHtml(APP.instance('FCom_Admin_Model_Role').options(), validator.fieldValue('role_id'))|raw }}
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-status">{{ 'Status'|_ }}</label>
        <div class="col-md-5">
            <select id="model-status" name="model[status]" class="form-control">
                {{ UTIL.optionsHtml(hlp.fieldOptions('status'), validator.fieldValue('status'))|raw }}
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-email">{{ 'Email'|_ }}</label>
        <div class="col-md-5">
            <input type="email" id="model-email" name="model[email]" class="required form-control" value="{{ validator.fieldValue('email') }}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-password">{{ 'Password'|_ }}</label>
        <div class="col-md-5">
            <input type="password" class="form-control" id="model-password" name="model[password]" value="" />
            <div class="progress" style="margin-bottom: 0; margin-top: 5px">
                <div id="progress-bar-password" class="progress-bar bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-password_confirm">{{ 'Confirm Password'|_ }}</label>
        <div class="col-md-5">
            <input type="password" id="model-password_confirm" name="model[password_confirm]" class="form-control" equalto="#model-password" value="" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-firstname">{{ 'First Name'|_ }}</label>
        <div class="col-md-5">
            <input type="text" id="model-firstname" name="model[firstname]" class="required form-control" value="{{ validator.fieldValue('firstname') }}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-lastname">{{ 'Last Name'|_ }}</label>
        <div class="col-md-5">
            <input type="text" id="model-lastname" name="model[lastname]" class="required form-control" value="{{ validator.fieldValue('lastname') }}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-api_username">{{ 'API Username'|_ }}</label>
        <div class="col-md-5">
            <input type="text" class="form-control" id="model-api_username" name="model[api_username]" value="{{ validator.fieldValue('api_username') }}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-md-2 control-label" for="model-api_password">{{ 'API Password'|_ }}</label>
        <div class="col-md-5">
            <input type="password" class="form-control" id="model-api_password" name="model[api_password]" />
        </div>
    </div>
</fieldset>

<script>
require(['jquery', 'jquery.validate', 'switch'], function($) {
    $(function() {
//        $('#users-form').validate();
        function init () {
            if ($('#model-superadmin').is(':checked')) {
                $('#model-role-id').attr('disabled', 'disabled');
            }
        }

        $('.make-switch').on('switch-change', function (e, data) {
            var val = data.value;
            if (val) {
                $('#model-role-id').attr('disabled', 'disabled');
            } else {
                $('#model-role-id').removeAttr('disabled', 'disabled');
            }
        });
        $('#model-password').parents('form').validate();
        $('#model-password').rules('add', {
            required: function () {
                var regex = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[~!@#$%^&*()_+=}{><;:\]\[?]).{7,}/;
                if (!regex.test($('#model-password').val())) {
                    return true;
                }
                return false;
            },
            minlength: 7,
            messages: {
                required: "Password must be at least 7 characters in length and must include at least one letter, one capital letter, one number, and one special character."
            }

        });
        $('#model-password').keyup(function () {
            var regex = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[~!@#$%^&*()_+=}{><;:\]\[?]).{7,}/;
            if (regex.test($(this).val())) {
                $('#progress-bar-password').css('width', '100%');
                $('#progress-bar-password').parent().removeClass('progress-warning');
            } else {
                $('#progress-bar-password').css('width', '50%');
                $('#progress-bar-password').parent().addClass('progress-warning');
            }
        });
        init();
    })
})
</script>
