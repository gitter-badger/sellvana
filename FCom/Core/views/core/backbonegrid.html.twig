{# Logic provided by FCom_Core_View_Backgrid #}

{% set data = THIS.getGridData() %}
{% set grid = THIS.getGrid() %}
{% set config = grid.config %}
{% set s = data.result.state %}
{% set pageUrl = THIS.pageChangeHref() %}


{# p=page, ps=pagesize, mp=maxpage, s=sort, sd=sortdir, c=totalrows #}
<div class="fcom-htmlgrid responsive-table dataTables_wrapper" id="{{ config.id }}">
  {# %form(method="get" action="#{$this->gridUrl()") #}
  {# %fieldset #}
  <div class="fcom-htmlgrid__toolbar btn-toolbar" style="height:45px">
    {# %input(type="text" name="search[_quick]" value="{{ s.search._quick ? s.search._quick }}") #}
    {# %input(type="submit" value="#{$this->_('Search')}") #}
      <!--
        <span class="fcom-htmlgrid__rows-status">{{ 'Rows %s - %s of %s'|_([1+s.rs, s.rs+s.rc, s.c]) }}</span>
        -->

        {% if config['data_mode']!= 'local' %}
          <ul class="pagination pagination-sm pagesize">
            {% for ps in THIS.pageSizeOptions() %}
              <li {{ ps==s.ps ? 'class="active"' }}>
                <a class="js-change-url page-size" href="#">{{ ps }}</a>
              </li>
            {% endfor %}
          </ul>

          <ul class="pagination pagination-sm page">
            {#
            <label>
              {{ 'Page'|_ }}
            </label>
            <input class="fcom-htmlgrid__gotopage js-change-url" data-href="{{ THIS.pageChangeHref() }}" value="{{ s.p }}">
            {{ 'of %s'|_(s.mp) }}
            #}
          </ul>
        {% endif %}

        {% for action in THIS.gridActions() %}
          {% if action.renderer %}
            {{ THIS.callUserFunc(action.renderer, [action]) | raw }}
          {% elseif action.html %}
            {{ action.html | raw }}
          {% endif %}
        {% endfor %}
        
        <span class="dropdown dd dd-nestable filter-span" style="display:inline;">
            <a data-toggle="dropdown" class="dropdown-toggle showhide_columns grid-refresh" href="#">
                Columns
                <b class="caret"></b>
            </a>
            
                <ol class="dd-list dropdown-menu">
                    <!--li calss="ui-state-default"-->
                    <!-- visibiility template -->
                    <!--/li -->
                </ol>
          
        </span>

  </div>
  {% if s.description %}
    <div class="fcom-htmlgrid__status-description">
      {{ s.description|raw }}
    </div>
  {% endif %}      
  <div class="scrollable-area">
    <div class="row datatables-top  {{ config.id | raw }}">
        <div class="col-sm-9">
        </div>
        <div class="col-sm-3 text-right">
            <div class="dataTables_filter" id="DataTables_Table_1_filter">
                <label>
                    Search: <input type="text" aria-controls="DataTables_Table_1" style="width: 200px;" class="form-control input-sm" placeholder="Search" id="{{ config.id | raw }}-quick-search">
                </label>
            </div>
        </div>
    </div> 
    <table class="fcom-htmlgrid__grid data-table-column-filter table table-bordered table-striped dataTable" id = {{ config.id | raw }}>
      {#<colgroup>
        {% foreach ($config['columns'] as $colId => $column) %}
          <col>(width="#{!empty($column['width']) ? $column['width'] : ''}")</col>
        {% end %}
      </colgroup>#}
      <thead>
        <tr id="tr-sort-{{ config.id }}" role="row">
          <!-- header template -->
        </tr>
      </thead>
      <tbody>
        {#{ THIS.rowsHtml() | raw }#}
        <!-- row template -->
      </tbody>      
    </table>
  </div>
</div>



<script type="template" id="{{ config.id }}-col-template">
  <div class="dd-handle dd3-handle">
    &nbsp;
  </div>
  <div class="dd3-content">
    <label>
        <input class="showhide_column" type="checkbox" datid=<%= rc.name %> <% if (rc.hidden === false) { %>checked <% } %> >
        <%= rc.label %>
    </label>
  </div>
</script>
<script type="template" id="{{ config.id }}-row-template">
  <tr id="<%= rc.id %>" class="<%= rc.cssClass %>">
  <% for (var index in rc.colsInfo) {          
    var col = rc.colsInfo[index];    
    if(col.hidden ) {      
      continue;
    }  

    print('<td data-col="' + col.name + '">');
    
    if (col.cell === 'select-row') { 
        print('<input type="checkbox" name="[{{ config.id}}][checked]['+rc.id+']">');      
    } else if (col.name === '_actions') {     
        print('&nbsp;&nbsp;');
        if (typeof (col.data.edit) != 'undefined') {
          print('<a class="btn btn-success btn-xs btn-edit" href="' + col.data.edit.href + rc[col.data.edit.col] + '">');
            print('<i class=" icon-edit-sign"></i>');
          print('</a>');
        }        
        print('&nbsp;&nbsp;');
        if (typeof(col.data.delete) !== 'undefined') {
          print('<a class="btn btn-danger btn-xs btn-delete" >');
            print('<i class="icon-remove"></i>');
          print('</a>');
        }
        
    } else {
        print(rc[col.name]);
    } 

    print('</td>');
  } %>
  </tr>
</script>

<script type='template' id="{{ config.id }}-header-template">
    <th id="th-sort-<%= rc.id %>" data-id="<%= rc.name %>" style="<% if (rc.width) { %> width:<%= rc.width %>px; <% } %>" class="<%= rc.cssClass %> sorting_<%= rc.sortState %>">

        <% if(rc.type === '' || rc.type === 'default') { %>
            <a class="js-change-url" style="cursor: pointer;">
                <%= rc.label %>
            </a>
        <% } else if (rc.type === 'multiselect') { %>
            <select class="js-sel">
                {{ UTIL.optionsHtml(THIS.multiselectToggleOptions(), THIS.multiselectCurrent()) | raw }}
            </select>
        <% } %>
    </th>
</script>
<script type='template' id="{{ config.id }}-multiselect-filter-template">
      <span><%= rc.label %>:</span>
      <span>
        <input type="hidden" id="multi_hidden" style="width:300px"/>
      </span>
</script>
<script type='template' id="{{ config.id }}-text-filter-template">    
    <button class='btn dropdown-toggle filter-text-main' data-toggle='dropdown'>
        <%= rc.label %>: 
        <% if(rc.filterVal ==='') { %> 
            All 
        <%} else { %>
            <%= rc.filterLabel %> "<%= rc.filterVal %>"
        <% } %>
        <span class="caret"></span>
    </button>
    
    <ul class="dropdown-menu filter-box">
        <div class="row">
          <div class="input-group">
                        <div class="btn-group dropdown">                        
                          <button class='btn dropdown-toggle filter-text-sub' data-toggle='dropdown' style='width:155px;margin-left:5px;margin-right:5px;'>
                              <%= rc.filterLabel%>
                              <span class='caret'></span>                
                          </button>            

                          <ul class='dropdown-menu filter-sub'>
                              <li>
                                  <a class='filter_op' data-id='contains' href='#'>contains</a>
                              </li>                                  
                              <li>
                                 <a class='filter_op' data-id='not' href='#'>does not contain</a>
                              </li>                                  
                              <li>
                                  <a class='filter_op' data-id='equal' href='#'>is equal to</a>
                              </li>                                  
                              <li>
                                  <a  class='filter_op' data-id='start' href='#'>start with</a>
                              </li>              
                              <li>
                                  <a class='filter_op' data-id='end' href='#'>end with</a>
                              </li>              
                          </ul>
                        </div>
                    
                        <input type="text" class="form-control" value="<%= rc.filterVal  %>" style = 'width:250px;margin-right:20px;' ></input>
                   
                        <button type="submit" class="btn btn-primary update">
                            <i class=" icon-check-sign"></i>
                            Update
                        </button>
        </div>
      </div>
    </ul>
 </script>
 
<script>
require(['jquery', 'fcom.backbonegrid'], function($) {
    //$(function() {
        var grid = new FCom.BackboneGrid({
            id: "{{ config.id }}",
            personalize_url: "{{ APP.href('my_account/personalize') }}",
            data_url: "{{ config.data_url }}",
            edit_url: "{{ config.edit_url }}",
            data: {{ THIS.getPageRowsData() | raw }},            
            columns: {{ THIS.getColumnsData() | raw }}, 
            data_mode: "{{ config.data_mode | raw }}",
            filters: {{ THIS.getFilterData()  | raw }}
        });
    //});
});
</script>
