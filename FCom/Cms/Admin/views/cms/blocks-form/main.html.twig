<!--{ label: CMS Block }-->
<!--{ pos: 10 }-->

{% set m = THIS.get('model') %}
{% set validator = THIS.get('validator', m) %}
{% import THIS.view('admin/form-elements').twigName() as forms %}

<fieldset class="form-horizontal">
    <div class="f-section">
        {{ forms.input({label: 'Handle'|_, required: 1, name: "model[handle]", value: validator.fieldValue('handle'), id: "model-handle" }) }}
        {{ forms.input({label: 'Description'|_, name: "model[description]", value: validator.fieldValue('description'), id: "model-description" }) }}
        {{ forms.select({label: 'Content Format'|_, options: LAYOUT.getAllRenderers(true), value: validator.fieldValue('renderer'), name: "model[renderer]",  id: "model-renderer" }) }}
        {{ forms.textarea({label: 'Content'|_, name: "model[content]", input_div_class: "col-md-10", input_class: "ckeditor",value:  validator.fieldValue('content'), id: "model-content" }) }}

    </div>
</fieldset>

<script>
require(['jquery', 'ckeditor', 'fcom.admin'], function($) {
    var renderers = {{ UTIL.toJson(LAYOUT.getAllRenderers()) | raw }};
    function updateEditor() {
        switch (renderers[$('#model-renderer').val()].editor) {
            case 'text': adminForm.wysiwygDestroy('main-content'); break;
            case 'html': adminForm.wysiwygCreate('main-content'); break;
        }
    }
    $('#model-renderer').change(updateEditor);
    updateEditor();
})
</script>
