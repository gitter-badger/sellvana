<!--{ label: CMS Block }-->
<!--{ pos: 10 }-->

{% set m = THIS.get('model') %}
{% set validator = THIS.get('validator', m) %}
{% import THIS.view('admin/form-elements').twigName() as forms %}
{% set fieldData = { validator: validator } %}
<fieldset class="form-horizontal">
    <div class="f-section">
        {{ forms.input(fieldData|merge({field:'handle', label:'Handle'|_, required: 1})) }}
        {{ forms.input(fieldData|merge({field:'description', label:'Description'|_})) }}
        {{ forms.select(fieldData|merge({field:'renderer', label:'Content Format'|_, options: LAYOUT.getAllRenderers(true)})) }}
        {{ forms.textarea(fieldData|merge({field:'content', label:'Content'|_,  input_class: "ckeditor", input_div_class: "col-md-10"})) }}
    </div>
</fieldset>

<script>
require(['jquery', 'ckeditor', 'fcom.admin'], function($) {
    var renderers = {{ UTIL.toJson(LAYOUT.getAllRenderers()) | raw }};
    function updateEditor() {
        switch (renderers[$('#model-renderer').val()].editor) {
            case 'text': adminForm.wysiwygDestroy('main-content'); break;
            case 'html': adminForm.wysiwygCreate('main-content'); break;
        }
    }
    $('#model-renderer').change(updateEditor);
    updateEditor();
})
</script>
