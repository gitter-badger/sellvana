{% set addToCartUrl = THIS.url('cart/add') %}

<ul class="thumbnails grid">
  {% for p in THIS.get('products') %}
  {% set productName = p.get('product_name') %}
  {% set productUrl = p.url(THIS.get('category')) %}
    <li class="col-lg-4 col-sm-6">
      <a class="prdocutname" href="product.html">{{ productName }}</a>
      <div class="thumbnail">
        {% if p.get('base_price') != p.get('sale_price') and p.get('sale_price') != 0 %}
            <span class="sale tooltip-test">Sale</span>
            <!--<span class="offer tooltip-test">Offer</span>-->
        {% endif %}
        <a href="{{ productUrl }}"><img alt="{{ productName }}" src="{{ p.thumbUrl(260, 337) }}"></a>
        <div class="shortlinks">
          <a class="details" href="{{ productUrl }}">DETAILS</a>
          <a class="wishlist" href="#">WISHLIST</a>
          <a class="compare" href="#">COMPARE</a>
        </div>
        <div class="pricetag">
          <span class="spiral"></span>

          <form class="form-inline" method="post" action="{{ addToCartUrl }}">
            <input type="hidden" name="action" value="add">
            <input type="hidden" name="qty" value="1">
            <button type="submit" name="id" value="{{ p.id() }}" class="productcart" onclick="return true; FCom.cart.add({{ p.id() }}, 1); return false">{{ 'ADD TO CART'|_ }}</button>
          </form>

          <div class="price">
            {% if p.get('base_price') == 0 %}
                <div class="pricenew">{{ 'FREE'|_ }}</div>
            {% elseif p.get('base_price') != p.get('sale_price') and p.get('sale_price') != 0 %}
                <div class="priceold">{{ p.get('base_price') | currency }}</div>
                <div class="pricenew">{{ p.get('sale_price') | currency }}</div>
            {% else %}
                <div class="pricenew">{{ p.get('base_price') | currency }}</div>
            {% endif %}

          </div>
        </div>
      </div>
    </li>
  {% endfor %}
</ul>
