Images grid with griddle

{% set m = THIS.get('model') %}
{% set prodImagesConfig = APP.instance('Sellvana_Catalog_Admin_Controller_Products').productImagesGridConfigForGriddle(m) %}


{# media lib #}
{% set mediaLib =  APP.instance('FCom_Admin_Controller_MediaLibrary') %}
{% set mediaActions = {
    "add-selected" : {
        caption: "Add selected images"
    }
} %}
{% set mediaConfig = {
    id: 'all_images',
    mode: 'images',
    type: 'product-images',
    title: 'Images',
    folder: 'media/product/images',
    config: {}
} %}

{% set mediaLibAttachConfig = mediaLib.gridConfig({'id': mediaConfig.id, 'folder': mediaConfig.folder, 'config': mediaConfig.config, 'mode': mediaConfig.mode}) %}

{% set mediaLibAttachConfigCompiled = THIS.view('core/griddle').set('grid', mediaLibAttachConfig).getGridConfig() %}

{# show main grid#}
{{ LAYOUT.view('core/griddle').set('grid', prodImagesConfig) | raw }}

<script>
    var mainGrid, attachGrid;
    require(['jquery', 'underscore', 'react', 'fcom.griddle', 'fcom.components', 'unique'], function ($, _, React, FComGriddleComponent, Components) {
        var mediaId = '{{ mediaConfig.id }}'
            ;

        window.showModalToAddImage = function(grid) {
            mainGrid = grid;

            console.log('showModalToAddImage');
            console.log('grid', grid);

            var mediaLibAttachConfigCompiled = {{ UTIL.toJson(mediaLibAttachConfigCompiled) | raw }};

            var modalEleContainer = document.getElementById('{{ prodImagesConfig.config.id }}-modal');
            React.unmountComponentAtNode(modalEleContainer);

            React.render(
                    React.createElement(Components.Modal, {
                                show: true,
                                title: 'Add images',
                                confirm: 'Add',
                                cancel: 'Close',
                                onConfirm: window.addSelectedImages
                            },
                            React.createElement("div", { className: "row f-grid-wrapper" }, React.createElement("div", { className: "tabbable" },
                                    React.createElement("ul", { className: "nav nav-tabs prod-type f-horiz-nav-tabs" },
                                            React.createElement("li", { className: "active" },
                                                    React.createElement("a", { "data-toggle": "tab", href: "#{{mediaConfig.id}}-attach_library" }, "Library")
                                            ),
                                            React.createElement("li", null,
                                                    React.createElement("a", { "data-toggle": "tab", href: "#{{mediaConfig.id}}-media-upload" }, "Uploads")
                                            )
                                    ),
                                    React.createElement("div", { className: "tab-content" },
                                            React.createElement("div", { className: "tab-pane active", id: "{{mediaConfig.id}}-attach_library" },
                                                    React.createElement(FComGriddleComponent, { config: mediaLibAttachConfigCompiled , "callbacks": {"componentDidMount": "setAttachGrid"}})),
                                            React.createElement("div", { className: "tab-pane", id: "{{mediaConfig.id}}-media-upload" }, "Pre content")
                                    )
                            )))
                    , modalEleContainer);

            //$('#' + mediaId + '_modal').modal('show');
        };

        window.addSelectedImages = function(modal) {
            //todo: function add selected items to main row
            modal.close();
        };

        window.setAttachGrid = function(grid) {
            console.log('setAttachGrid');
            attachGrid = grid;
        };
    });
</script>